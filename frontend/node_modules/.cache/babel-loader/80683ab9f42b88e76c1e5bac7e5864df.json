{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nvar _excluded = [\"onClick\", \"onKeyDown\", \"onFocus\", \"onBlur\", \"onMouseUp\", \"onPaste\", \"error\", \"clearable\", \"onClear\", \"disabled\"];\nimport * as React from 'react';\nimport useEnhancedEffect from '@mui/utils/useEnhancedEffect';\nimport useEventCallback from '@mui/utils/useEventCallback';\nimport useForkRef from '@mui/utils/useForkRef';\nimport { useTheme } from '@mui/material/styles';\nimport { useValidation } from '../useValidation';\nimport { useUtils } from '../useUtils';\nimport { adjustSectionValue, isAndroid, cleanString, getSectionOrder } from './useField.utils';\nimport { useFieldState } from './useFieldState';\nimport { useFieldCharacterEditing } from './useFieldCharacterEditing';\nimport { getActiveElement } from '../../utils/utils';\nexport var useField = function useField(params) {\n  var utils = useUtils();\n\n  var _useFieldState = useFieldState(params),\n      state = _useFieldState.state,\n      selectedSectionIndexes = _useFieldState.selectedSectionIndexes,\n      _setSelectedSections = _useFieldState.setSelectedSections,\n      clearValue = _useFieldState.clearValue,\n      clearActiveSection = _useFieldState.clearActiveSection,\n      updateSectionValue = _useFieldState.updateSectionValue,\n      updateValueFromValueStr = _useFieldState.updateValueFromValueStr,\n      setTempAndroidValueStr = _useFieldState.setTempAndroidValueStr,\n      sectionsValueBoundaries = _useFieldState.sectionsValueBoundaries,\n      placeholder = _useFieldState.placeholder,\n      timezone = _useFieldState.timezone;\n\n  var inputRefProp = params.inputRef,\n      internalProps = params.internalProps,\n      _params$internalProps = params.internalProps,\n      _params$internalProps2 = _params$internalProps.readOnly,\n      readOnly = _params$internalProps2 === void 0 ? false : _params$internalProps2,\n      unstableFieldRef = _params$internalProps.unstableFieldRef,\n      minutesStep = _params$internalProps.minutesStep,\n      _params$forwardedProp = params.forwardedProps,\n      onClick = _params$forwardedProp.onClick,\n      onKeyDown = _params$forwardedProp.onKeyDown,\n      onFocus = _params$forwardedProp.onFocus,\n      onBlur = _params$forwardedProp.onBlur,\n      onMouseUp = _params$forwardedProp.onMouseUp,\n      onPaste = _params$forwardedProp.onPaste,\n      error = _params$forwardedProp.error,\n      clearable = _params$forwardedProp.clearable,\n      onClear = _params$forwardedProp.onClear,\n      disabled = _params$forwardedProp.disabled,\n      fieldValueManager = params.fieldValueManager,\n      valueManager = params.valueManager,\n      validator = params.validator,\n      otherForwardedProps = _objectWithoutPropertiesLoose(params.forwardedProps, _excluded);\n\n  var _useFieldCharacterEdi = useFieldCharacterEditing({\n    sections: state.sections,\n    updateSectionValue: updateSectionValue,\n    sectionsValueBoundaries: sectionsValueBoundaries,\n    setTempAndroidValueStr: setTempAndroidValueStr,\n    timezone: timezone\n  }),\n      applyCharacterEditing = _useFieldCharacterEdi.applyCharacterEditing,\n      resetCharacterQuery = _useFieldCharacterEdi.resetCharacterQuery;\n\n  var inputRef = React.useRef(null);\n  var handleRef = useForkRef(inputRefProp, inputRef);\n  var focusTimeoutRef = React.useRef(undefined);\n  var theme = useTheme();\n  var isRTL = theme.direction === 'rtl';\n  var sectionOrder = React.useMemo(function () {\n    return getSectionOrder(state.sections, isRTL);\n  }, [state.sections, isRTL]);\n\n  var syncSelectionFromDOM = function syncSelectionFromDOM() {\n    var _selectionStart;\n\n    if (readOnly) {\n      _setSelectedSections(null);\n\n      return;\n    }\n\n    var browserStartIndex = (_selectionStart = inputRef.current.selectionStart) != null ? _selectionStart : 0;\n    var nextSectionIndex;\n\n    if (browserStartIndex <= state.sections[0].startInInput) {\n      // Special case if browser index is in invisible characters at the beginning\n      nextSectionIndex = 1;\n    } else if (browserStartIndex >= state.sections[state.sections.length - 1].endInInput) {\n      // If the click is after the last character of the input, then we want to select the 1st section.\n      nextSectionIndex = 1;\n    } else {\n      nextSectionIndex = state.sections.findIndex(function (section) {\n        return section.startInInput - section.startSeparator.length > browserStartIndex;\n      });\n    }\n\n    var sectionIndex = nextSectionIndex === -1 ? state.sections.length - 1 : nextSectionIndex - 1;\n\n    _setSelectedSections(sectionIndex);\n  };\n\n  var handleInputClick = useEventCallback(function (event) {\n    // The click event on the clear button would propagate to the input, trigger this handler and result in a wrong section selection.\n    // We avoid this by checking if the call of `handleInputClick` is actually intended, or a side effect.\n    if (event.isDefaultPrevented()) {\n      return;\n    }\n\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n\n    onClick == null || onClick.apply(void 0, [event].concat(args));\n    syncSelectionFromDOM();\n  });\n  var handleInputMouseUp = useEventCallback(function (event) {\n    onMouseUp == null || onMouseUp(event); // Without this, the browser will remove the selected when clicking inside an already-selected section.\n\n    event.preventDefault();\n  });\n  var handleInputFocus = useEventCallback(function () {\n    onFocus == null || onFocus.apply(void 0, arguments); // The ref is guaranteed to be resolved at this point.\n\n    var input = inputRef.current;\n    window.clearTimeout(focusTimeoutRef.current);\n    focusTimeoutRef.current = setTimeout(function () {\n      // The ref changed, the component got remounted, the focus event is no longer relevant.\n      if (!input || input !== inputRef.current) {\n        return;\n      }\n\n      if (selectedSectionIndexes != null || readOnly) {\n        return;\n      }\n\n      if ( // avoid selecting all sections when focusing empty field without value\n      input.value.length && Number(input.selectionEnd) - Number(input.selectionStart) === input.value.length) {\n        _setSelectedSections('all');\n      } else {\n        syncSelectionFromDOM();\n      }\n    });\n  });\n  var handleInputBlur = useEventCallback(function () {\n    onBlur == null || onBlur.apply(void 0, arguments);\n\n    _setSelectedSections(null);\n  });\n  var handleInputPaste = useEventCallback(function (event) {\n    onPaste == null || onPaste(event);\n\n    if (readOnly) {\n      event.preventDefault();\n      return;\n    }\n\n    var pastedValue = event.clipboardData.getData('text');\n\n    if (selectedSectionIndexes && selectedSectionIndexes.startIndex === selectedSectionIndexes.endIndex) {\n      var activeSection = state.sections[selectedSectionIndexes.startIndex];\n      var lettersOnly = /^[a-zA-Z]+$/.test(pastedValue);\n      var digitsOnly = /^[0-9]+$/.test(pastedValue);\n      var digitsAndLetterOnly = /^(([a-zA-Z]+)|)([0-9]+)(([a-zA-Z]+)|)$/.test(pastedValue);\n      var isValidPastedValue = activeSection.contentType === 'letter' && lettersOnly || activeSection.contentType === 'digit' && digitsOnly || activeSection.contentType === 'digit-with-letter' && digitsAndLetterOnly;\n\n      if (isValidPastedValue) {\n        resetCharacterQuery();\n        updateSectionValue({\n          activeSection: activeSection,\n          newSectionValue: pastedValue,\n          shouldGoToNextSection: true\n        }); // prevent default to avoid the input change handler being called\n\n        event.preventDefault();\n        return;\n      }\n\n      if (lettersOnly || digitsOnly) {\n        // The pasted value correspond to a single section but not the expected type\n        // skip the modification\n        event.preventDefault();\n        return;\n      }\n    }\n\n    event.preventDefault();\n    resetCharacterQuery();\n    updateValueFromValueStr(pastedValue);\n  });\n  var handleInputChange = useEventCallback(function (event) {\n    if (readOnly) {\n      return;\n    }\n\n    var targetValue = event.target.value;\n\n    if (targetValue === '') {\n      resetCharacterQuery();\n      clearValue();\n      return;\n    }\n\n    var eventData = event.nativeEvent.data; // Calling `.fill(04/11/2022)` in playwright will trigger a change event with the requested content to insert in `event.nativeEvent.data`\n    // usual changes have only the currently typed character in the `event.nativeEvent.data`\n\n    var shouldUseEventData = eventData && eventData.length > 1;\n    var valueStr = shouldUseEventData ? eventData : targetValue;\n    var cleanValueStr = cleanString(valueStr); // If no section is selected or eventData should be used, we just try to parse the new value\n    // This line is mostly triggered by imperative code / application tests.\n\n    if (selectedSectionIndexes == null || shouldUseEventData) {\n      updateValueFromValueStr(shouldUseEventData ? eventData : cleanValueStr);\n      return;\n    }\n\n    var keyPressed;\n\n    if (selectedSectionIndexes.startIndex === 0 && selectedSectionIndexes.endIndex === state.sections.length - 1 && cleanValueStr.length === 1) {\n      keyPressed = cleanValueStr;\n    } else {\n      var prevValueStr = cleanString(fieldValueManager.getValueStrFromSections(state.sections, isRTL));\n      var startOfDiffIndex = -1;\n      var endOfDiffIndex = -1;\n\n      for (var i = 0; i < prevValueStr.length; i += 1) {\n        if (startOfDiffIndex === -1 && prevValueStr[i] !== cleanValueStr[i]) {\n          startOfDiffIndex = i;\n        }\n\n        if (endOfDiffIndex === -1 && prevValueStr[prevValueStr.length - i - 1] !== cleanValueStr[cleanValueStr.length - i - 1]) {\n          endOfDiffIndex = i;\n        }\n      }\n\n      var activeSection = state.sections[selectedSectionIndexes.startIndex];\n      var hasDiffOutsideOfActiveSection = startOfDiffIndex < activeSection.start || prevValueStr.length - endOfDiffIndex - 1 > activeSection.end;\n\n      if (hasDiffOutsideOfActiveSection) {\n        // TODO: Support if the new date is valid\n        return;\n      } // The active section being selected, the browser has replaced its value with the key pressed by the user.\n\n\n      var activeSectionEndRelativeToNewValue = cleanValueStr.length - prevValueStr.length + activeSection.end - cleanString(activeSection.endSeparator || '').length;\n      keyPressed = cleanValueStr.slice(activeSection.start + cleanString(activeSection.startSeparator || '').length, activeSectionEndRelativeToNewValue);\n    }\n\n    if (keyPressed.length === 0) {\n      if (isAndroid()) {\n        setTempAndroidValueStr(valueStr);\n      } else {\n        resetCharacterQuery();\n        clearActiveSection();\n      }\n\n      return;\n    }\n\n    applyCharacterEditing({\n      keyPressed: keyPressed,\n      sectionIndex: selectedSectionIndexes.startIndex\n    });\n  });\n  var handleInputKeyDown = useEventCallback(function (event) {\n    onKeyDown == null || onKeyDown(event); // eslint-disable-next-line default-case\n\n    switch (true) {\n      // Select all\n      case event.key === 'a' && (event.ctrlKey || event.metaKey):\n        {\n          // prevent default to make sure that the next line \"select all\" while updating\n          // the internal state at the same time.\n          event.preventDefault();\n\n          _setSelectedSections('all');\n\n          break;\n        }\n      // Move selection to next section\n\n      case event.key === 'ArrowRight':\n        {\n          event.preventDefault();\n\n          if (selectedSectionIndexes == null) {\n            _setSelectedSections(sectionOrder.startIndex);\n          } else if (selectedSectionIndexes.startIndex !== selectedSectionIndexes.endIndex) {\n            _setSelectedSections(selectedSectionIndexes.endIndex);\n          } else {\n            var nextSectionIndex = sectionOrder.neighbors[selectedSectionIndexes.startIndex].rightIndex;\n\n            if (nextSectionIndex !== null) {\n              _setSelectedSections(nextSectionIndex);\n            }\n          }\n\n          break;\n        }\n      // Move selection to previous section\n\n      case event.key === 'ArrowLeft':\n        {\n          event.preventDefault();\n\n          if (selectedSectionIndexes == null) {\n            _setSelectedSections(sectionOrder.endIndex);\n          } else if (selectedSectionIndexes.startIndex !== selectedSectionIndexes.endIndex) {\n            _setSelectedSections(selectedSectionIndexes.startIndex);\n          } else {\n            var _nextSectionIndex = sectionOrder.neighbors[selectedSectionIndexes.startIndex].leftIndex;\n\n            if (_nextSectionIndex !== null) {\n              _setSelectedSections(_nextSectionIndex);\n            }\n          }\n\n          break;\n        }\n      // Reset the value of the selected section\n\n      case event.key === 'Delete':\n        {\n          event.preventDefault();\n\n          if (readOnly) {\n            break;\n          }\n\n          if (selectedSectionIndexes == null || selectedSectionIndexes.startIndex === 0 && selectedSectionIndexes.endIndex === state.sections.length - 1) {\n            clearValue();\n          } else {\n            clearActiveSection();\n          }\n\n          resetCharacterQuery();\n          break;\n        }\n      // Increment / decrement the selected section value\n\n      case ['ArrowUp', 'ArrowDown', 'Home', 'End', 'PageUp', 'PageDown'].includes(event.key):\n        {\n          event.preventDefault();\n\n          if (readOnly || selectedSectionIndexes == null) {\n            break;\n          }\n\n          var activeSection = state.sections[selectedSectionIndexes.startIndex];\n          var activeDateManager = fieldValueManager.getActiveDateManager(utils, state, activeSection);\n          var newSectionValue = adjustSectionValue(utils, timezone, activeSection, event.key, sectionsValueBoundaries, activeDateManager.date, {\n            minutesStep: minutesStep\n          });\n          updateSectionValue({\n            activeSection: activeSection,\n            newSectionValue: newSectionValue,\n            shouldGoToNextSection: false\n          });\n          break;\n        }\n    }\n  });\n  useEnhancedEffect(function () {\n    if (!inputRef.current) {\n      return;\n    }\n\n    if (selectedSectionIndexes == null) {\n      if (inputRef.current.scrollLeft) {\n        // Ensure that input content is not marked as selected.\n        // setting selection range to 0 causes issues in Safari.\n        // https://bugs.webkit.org/show_bug.cgi?id=224425\n        inputRef.current.scrollLeft = 0;\n      }\n\n      return;\n    }\n\n    var firstSelectedSection = state.sections[selectedSectionIndexes.startIndex];\n    var lastSelectedSection = state.sections[selectedSectionIndexes.endIndex];\n    var selectionStart = firstSelectedSection.startInInput;\n    var selectionEnd = lastSelectedSection.endInInput;\n\n    if (selectedSectionIndexes.shouldSelectBoundarySelectors) {\n      selectionStart -= firstSelectedSection.startSeparator.length;\n      selectionEnd += lastSelectedSection.endSeparator.length;\n    }\n\n    if (selectionStart !== inputRef.current.selectionStart || selectionEnd !== inputRef.current.selectionEnd) {\n      // Fix scroll jumping on iOS browser: https://github.com/mui/mui-x/issues/8321\n      var currentScrollTop = inputRef.current.scrollTop; // On multi input range pickers we want to update selection range only for the active input\n      // This helps to avoid the focus jumping on Safari https://github.com/mui/mui-x/issues/9003\n      // because WebKit implements the `setSelectionRange` based on the spec: https://bugs.webkit.org/show_bug.cgi?id=224425\n\n      if (inputRef.current === getActiveElement(document)) {\n        inputRef.current.setSelectionRange(selectionStart, selectionEnd);\n      } // Even reading this variable seems to do the trick, but also setting it just to make use of it\n\n\n      inputRef.current.scrollTop = currentScrollTop;\n    }\n  });\n  var validationError = useValidation(_extends({}, internalProps, {\n    value: state.value,\n    timezone: timezone\n  }), validator, valueManager.isSameError, valueManager.defaultErrorState);\n  var inputError = React.useMemo(function () {\n    // only override when `error` is undefined.\n    // in case of multi input fields, the `error` value is provided externally and will always be defined.\n    if (error !== undefined) {\n      return error;\n    }\n\n    return valueManager.hasError(validationError);\n  }, [valueManager, validationError, error]);\n  React.useEffect(function () {\n    if (!inputError && !selectedSectionIndexes) {\n      resetCharacterQuery();\n    }\n  }, [state.referenceValue, selectedSectionIndexes, inputError]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  React.useEffect(function () {\n    // Select the right section when focused on mount (`autoFocus = true` on the input)\n    if (inputRef.current && inputRef.current === document.activeElement) {\n      _setSelectedSections('all');\n    }\n\n    return function () {\n      return window.clearTimeout(focusTimeoutRef.current);\n    };\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\n  // If `state.tempValueStrAndroid` is still defined when running `useEffect`,\n  // Then `onChange` has only been called once, which means the user pressed `Backspace` to reset the section.\n  // This causes a small flickering on Android,\n  // But we can't use `useEnhancedEffect` which is always called before the second `onChange` call and then would cause false positives.\n\n  React.useEffect(function () {\n    if (state.tempValueStrAndroid != null && selectedSectionIndexes != null) {\n      resetCharacterQuery();\n      clearActiveSection();\n    }\n  }, [state.tempValueStrAndroid]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  var valueStr = React.useMemo(function () {\n    var _state$tempValueStrAn;\n\n    return (_state$tempValueStrAn = state.tempValueStrAndroid) != null ? _state$tempValueStrAn : fieldValueManager.getValueStrFromSections(state.sections, isRTL);\n  }, [state.sections, fieldValueManager, state.tempValueStrAndroid, isRTL]);\n  var inputMode = React.useMemo(function () {\n    if (selectedSectionIndexes == null) {\n      return 'text';\n    }\n\n    if (state.sections[selectedSectionIndexes.startIndex].contentType === 'letter') {\n      return 'text';\n    }\n\n    return 'numeric';\n  }, [selectedSectionIndexes, state.sections]);\n  var inputHasFocus = inputRef.current && inputRef.current === getActiveElement(document);\n  var areAllSectionsEmpty = valueManager.areValuesEqual(utils, state.value, valueManager.emptyValue);\n  var shouldShowPlaceholder = !inputHasFocus && areAllSectionsEmpty;\n  React.useImperativeHandle(unstableFieldRef, function () {\n    return {\n      getSections: function getSections() {\n        return state.sections;\n      },\n      getActiveSectionIndex: function getActiveSectionIndex() {\n        var _selectionStart2, _selectionEnd;\n\n        var browserStartIndex = (_selectionStart2 = inputRef.current.selectionStart) != null ? _selectionStart2 : 0;\n        var browserEndIndex = (_selectionEnd = inputRef.current.selectionEnd) != null ? _selectionEnd : 0;\n\n        if (browserStartIndex === 0 && browserEndIndex === 0) {\n          return null;\n        }\n\n        var nextSectionIndex = browserStartIndex <= state.sections[0].startInInput ? 1 // Special case if browser index is in invisible characters at the beginning.\n        : state.sections.findIndex(function (section) {\n          return section.startInInput - section.startSeparator.length > browserStartIndex;\n        });\n        return nextSectionIndex === -1 ? state.sections.length - 1 : nextSectionIndex - 1;\n      },\n      setSelectedSections: function setSelectedSections(activeSectionIndex) {\n        return _setSelectedSections(activeSectionIndex);\n      }\n    };\n  });\n  var handleClearValue = useEventCallback(function (event) {\n    var _inputRef$current;\n\n    event.preventDefault();\n\n    for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n      args[_key2 - 1] = arguments[_key2];\n    }\n\n    onClear == null || onClear.apply(void 0, [event].concat(args));\n    clearValue();\n    inputRef == null || (_inputRef$current = inputRef.current) == null || _inputRef$current.focus();\n\n    _setSelectedSections(0);\n  });\n  return _extends({\n    placeholder: placeholder,\n    autoComplete: 'off',\n    disabled: Boolean(disabled)\n  }, otherForwardedProps, {\n    value: shouldShowPlaceholder ? '' : valueStr,\n    inputMode: inputMode,\n    readOnly: readOnly,\n    onClick: handleInputClick,\n    onFocus: handleInputFocus,\n    onBlur: handleInputBlur,\n    onPaste: handleInputPaste,\n    onChange: handleInputChange,\n    onKeyDown: handleInputKeyDown,\n    onMouseUp: handleInputMouseUp,\n    onClear: handleClearValue,\n    error: inputError,\n    ref: handleRef,\n    clearable: Boolean(clearable && !areAllSectionsEmpty && !readOnly && !disabled)\n  });\n};","map":{"version":3,"sources":["/home/brenomatheus/Documentos/frontend/node_modules/@mui/x-date-pickers/internals/hooks/useField/useField.js"],"names":["_extends","_objectWithoutPropertiesLoose","_excluded","React","useEnhancedEffect","useEventCallback","useForkRef","useTheme","useValidation","useUtils","adjustSectionValue","isAndroid","cleanString","getSectionOrder","useFieldState","useFieldCharacterEditing","getActiveElement","useField","params","utils","state","selectedSectionIndexes","setSelectedSections","clearValue","clearActiveSection","updateSectionValue","updateValueFromValueStr","setTempAndroidValueStr","sectionsValueBoundaries","placeholder","timezone","inputRefProp","inputRef","internalProps","readOnly","unstableFieldRef","minutesStep","forwardedProps","onClick","onKeyDown","onFocus","onBlur","onMouseUp","onPaste","error","clearable","onClear","disabled","fieldValueManager","valueManager","validator","otherForwardedProps","sections","applyCharacterEditing","resetCharacterQuery","useRef","handleRef","focusTimeoutRef","undefined","theme","isRTL","direction","sectionOrder","useMemo","syncSelectionFromDOM","_selectionStart","browserStartIndex","current","selectionStart","nextSectionIndex","startInInput","length","endInInput","findIndex","section","startSeparator","sectionIndex","handleInputClick","event","isDefaultPrevented","args","handleInputMouseUp","preventDefault","handleInputFocus","input","window","clearTimeout","setTimeout","value","Number","selectionEnd","handleInputBlur","handleInputPaste","pastedValue","clipboardData","getData","startIndex","endIndex","activeSection","lettersOnly","test","digitsOnly","digitsAndLetterOnly","isValidPastedValue","contentType","newSectionValue","shouldGoToNextSection","handleInputChange","targetValue","target","eventData","nativeEvent","data","shouldUseEventData","valueStr","cleanValueStr","keyPressed","prevValueStr","getValueStrFromSections","startOfDiffIndex","endOfDiffIndex","i","hasDiffOutsideOfActiveSection","start","end","activeSectionEndRelativeToNewValue","endSeparator","slice","handleInputKeyDown","key","ctrlKey","metaKey","neighbors","rightIndex","leftIndex","includes","activeDateManager","getActiveDateManager","date","scrollLeft","firstSelectedSection","lastSelectedSection","shouldSelectBoundarySelectors","currentScrollTop","scrollTop","document","setSelectionRange","validationError","isSameError","defaultErrorState","inputError","hasError","useEffect","referenceValue","activeElement","tempValueStrAndroid","_state$tempValueStrAn","inputMode","inputHasFocus","areAllSectionsEmpty","areValuesEqual","emptyValue","shouldShowPlaceholder","useImperativeHandle","getSections","getActiveSectionIndex","_selectionStart2","_selectionEnd","browserEndIndex","activeSectionIndex","handleClearValue","_inputRef$current","focus","autoComplete","Boolean","onChange","ref"],"mappings":"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","sourcesContent":["import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nconst _excluded = [\"onClick\", \"onKeyDown\", \"onFocus\", \"onBlur\", \"onMouseUp\", \"onPaste\", \"error\", \"clearable\", \"onClear\", \"disabled\"];\nimport * as React from 'react';\nimport useEnhancedEffect from '@mui/utils/useEnhancedEffect';\nimport useEventCallback from '@mui/utils/useEventCallback';\nimport useForkRef from '@mui/utils/useForkRef';\nimport { useTheme } from '@mui/material/styles';\nimport { useValidation } from '../useValidation';\nimport { useUtils } from '../useUtils';\nimport { adjustSectionValue, isAndroid, cleanString, getSectionOrder } from './useField.utils';\nimport { useFieldState } from './useFieldState';\nimport { useFieldCharacterEditing } from './useFieldCharacterEditing';\nimport { getActiveElement } from '../../utils/utils';\nexport const useField = params => {\n  const utils = useUtils();\n  const {\n    state,\n    selectedSectionIndexes,\n    setSelectedSections,\n    clearValue,\n    clearActiveSection,\n    updateSectionValue,\n    updateValueFromValueStr,\n    setTempAndroidValueStr,\n    sectionsValueBoundaries,\n    placeholder,\n    timezone\n  } = useFieldState(params);\n  const {\n      inputRef: inputRefProp,\n      internalProps,\n      internalProps: {\n        readOnly = false,\n        unstableFieldRef,\n        minutesStep\n      },\n      forwardedProps: {\n        onClick,\n        onKeyDown,\n        onFocus,\n        onBlur,\n        onMouseUp,\n        onPaste,\n        error,\n        clearable,\n        onClear,\n        disabled\n      },\n      fieldValueManager,\n      valueManager,\n      validator\n    } = params,\n    otherForwardedProps = _objectWithoutPropertiesLoose(params.forwardedProps, _excluded);\n  const {\n    applyCharacterEditing,\n    resetCharacterQuery\n  } = useFieldCharacterEditing({\n    sections: state.sections,\n    updateSectionValue,\n    sectionsValueBoundaries,\n    setTempAndroidValueStr,\n    timezone\n  });\n  const inputRef = React.useRef(null);\n  const handleRef = useForkRef(inputRefProp, inputRef);\n  const focusTimeoutRef = React.useRef(undefined);\n  const theme = useTheme();\n  const isRTL = theme.direction === 'rtl';\n  const sectionOrder = React.useMemo(() => getSectionOrder(state.sections, isRTL), [state.sections, isRTL]);\n  const syncSelectionFromDOM = () => {\n    var _selectionStart;\n    if (readOnly) {\n      setSelectedSections(null);\n      return;\n    }\n    const browserStartIndex = (_selectionStart = inputRef.current.selectionStart) != null ? _selectionStart : 0;\n    let nextSectionIndex;\n    if (browserStartIndex <= state.sections[0].startInInput) {\n      // Special case if browser index is in invisible characters at the beginning\n      nextSectionIndex = 1;\n    } else if (browserStartIndex >= state.sections[state.sections.length - 1].endInInput) {\n      // If the click is after the last character of the input, then we want to select the 1st section.\n      nextSectionIndex = 1;\n    } else {\n      nextSectionIndex = state.sections.findIndex(section => section.startInInput - section.startSeparator.length > browserStartIndex);\n    }\n    const sectionIndex = nextSectionIndex === -1 ? state.sections.length - 1 : nextSectionIndex - 1;\n    setSelectedSections(sectionIndex);\n  };\n  const handleInputClick = useEventCallback((event, ...args) => {\n    // The click event on the clear button would propagate to the input, trigger this handler and result in a wrong section selection.\n    // We avoid this by checking if the call of `handleInputClick` is actually intended, or a side effect.\n    if (event.isDefaultPrevented()) {\n      return;\n    }\n    onClick == null || onClick(event, ...args);\n    syncSelectionFromDOM();\n  });\n  const handleInputMouseUp = useEventCallback(event => {\n    onMouseUp == null || onMouseUp(event);\n\n    // Without this, the browser will remove the selected when clicking inside an already-selected section.\n    event.preventDefault();\n  });\n  const handleInputFocus = useEventCallback((...args) => {\n    onFocus == null || onFocus(...args);\n    // The ref is guaranteed to be resolved at this point.\n    const input = inputRef.current;\n    window.clearTimeout(focusTimeoutRef.current);\n    focusTimeoutRef.current = setTimeout(() => {\n      // The ref changed, the component got remounted, the focus event is no longer relevant.\n      if (!input || input !== inputRef.current) {\n        return;\n      }\n      if (selectedSectionIndexes != null || readOnly) {\n        return;\n      }\n      if (\n      // avoid selecting all sections when focusing empty field without value\n      input.value.length && Number(input.selectionEnd) - Number(input.selectionStart) === input.value.length) {\n        setSelectedSections('all');\n      } else {\n        syncSelectionFromDOM();\n      }\n    });\n  });\n  const handleInputBlur = useEventCallback((...args) => {\n    onBlur == null || onBlur(...args);\n    setSelectedSections(null);\n  });\n  const handleInputPaste = useEventCallback(event => {\n    onPaste == null || onPaste(event);\n    if (readOnly) {\n      event.preventDefault();\n      return;\n    }\n    const pastedValue = event.clipboardData.getData('text');\n    if (selectedSectionIndexes && selectedSectionIndexes.startIndex === selectedSectionIndexes.endIndex) {\n      const activeSection = state.sections[selectedSectionIndexes.startIndex];\n      const lettersOnly = /^[a-zA-Z]+$/.test(pastedValue);\n      const digitsOnly = /^[0-9]+$/.test(pastedValue);\n      const digitsAndLetterOnly = /^(([a-zA-Z]+)|)([0-9]+)(([a-zA-Z]+)|)$/.test(pastedValue);\n      const isValidPastedValue = activeSection.contentType === 'letter' && lettersOnly || activeSection.contentType === 'digit' && digitsOnly || activeSection.contentType === 'digit-with-letter' && digitsAndLetterOnly;\n      if (isValidPastedValue) {\n        resetCharacterQuery();\n        updateSectionValue({\n          activeSection,\n          newSectionValue: pastedValue,\n          shouldGoToNextSection: true\n        });\n        // prevent default to avoid the input change handler being called\n        event.preventDefault();\n        return;\n      }\n      if (lettersOnly || digitsOnly) {\n        // The pasted value correspond to a single section but not the expected type\n        // skip the modification\n        event.preventDefault();\n        return;\n      }\n    }\n    event.preventDefault();\n    resetCharacterQuery();\n    updateValueFromValueStr(pastedValue);\n  });\n  const handleInputChange = useEventCallback(event => {\n    if (readOnly) {\n      return;\n    }\n    const targetValue = event.target.value;\n    if (targetValue === '') {\n      resetCharacterQuery();\n      clearValue();\n      return;\n    }\n    const eventData = event.nativeEvent.data;\n    // Calling `.fill(04/11/2022)` in playwright will trigger a change event with the requested content to insert in `event.nativeEvent.data`\n    // usual changes have only the currently typed character in the `event.nativeEvent.data`\n    const shouldUseEventData = eventData && eventData.length > 1;\n    const valueStr = shouldUseEventData ? eventData : targetValue;\n    const cleanValueStr = cleanString(valueStr);\n\n    // If no section is selected or eventData should be used, we just try to parse the new value\n    // This line is mostly triggered by imperative code / application tests.\n    if (selectedSectionIndexes == null || shouldUseEventData) {\n      updateValueFromValueStr(shouldUseEventData ? eventData : cleanValueStr);\n      return;\n    }\n    let keyPressed;\n    if (selectedSectionIndexes.startIndex === 0 && selectedSectionIndexes.endIndex === state.sections.length - 1 && cleanValueStr.length === 1) {\n      keyPressed = cleanValueStr;\n    } else {\n      const prevValueStr = cleanString(fieldValueManager.getValueStrFromSections(state.sections, isRTL));\n      let startOfDiffIndex = -1;\n      let endOfDiffIndex = -1;\n      for (let i = 0; i < prevValueStr.length; i += 1) {\n        if (startOfDiffIndex === -1 && prevValueStr[i] !== cleanValueStr[i]) {\n          startOfDiffIndex = i;\n        }\n        if (endOfDiffIndex === -1 && prevValueStr[prevValueStr.length - i - 1] !== cleanValueStr[cleanValueStr.length - i - 1]) {\n          endOfDiffIndex = i;\n        }\n      }\n      const activeSection = state.sections[selectedSectionIndexes.startIndex];\n      const hasDiffOutsideOfActiveSection = startOfDiffIndex < activeSection.start || prevValueStr.length - endOfDiffIndex - 1 > activeSection.end;\n      if (hasDiffOutsideOfActiveSection) {\n        // TODO: Support if the new date is valid\n        return;\n      }\n\n      // The active section being selected, the browser has replaced its value with the key pressed by the user.\n      const activeSectionEndRelativeToNewValue = cleanValueStr.length - prevValueStr.length + activeSection.end - cleanString(activeSection.endSeparator || '').length;\n      keyPressed = cleanValueStr.slice(activeSection.start + cleanString(activeSection.startSeparator || '').length, activeSectionEndRelativeToNewValue);\n    }\n    if (keyPressed.length === 0) {\n      if (isAndroid()) {\n        setTempAndroidValueStr(valueStr);\n      } else {\n        resetCharacterQuery();\n        clearActiveSection();\n      }\n      return;\n    }\n    applyCharacterEditing({\n      keyPressed,\n      sectionIndex: selectedSectionIndexes.startIndex\n    });\n  });\n  const handleInputKeyDown = useEventCallback(event => {\n    onKeyDown == null || onKeyDown(event);\n\n    // eslint-disable-next-line default-case\n    switch (true) {\n      // Select all\n      case event.key === 'a' && (event.ctrlKey || event.metaKey):\n        {\n          // prevent default to make sure that the next line \"select all\" while updating\n          // the internal state at the same time.\n          event.preventDefault();\n          setSelectedSections('all');\n          break;\n        }\n\n      // Move selection to next section\n      case event.key === 'ArrowRight':\n        {\n          event.preventDefault();\n          if (selectedSectionIndexes == null) {\n            setSelectedSections(sectionOrder.startIndex);\n          } else if (selectedSectionIndexes.startIndex !== selectedSectionIndexes.endIndex) {\n            setSelectedSections(selectedSectionIndexes.endIndex);\n          } else {\n            const nextSectionIndex = sectionOrder.neighbors[selectedSectionIndexes.startIndex].rightIndex;\n            if (nextSectionIndex !== null) {\n              setSelectedSections(nextSectionIndex);\n            }\n          }\n          break;\n        }\n\n      // Move selection to previous section\n      case event.key === 'ArrowLeft':\n        {\n          event.preventDefault();\n          if (selectedSectionIndexes == null) {\n            setSelectedSections(sectionOrder.endIndex);\n          } else if (selectedSectionIndexes.startIndex !== selectedSectionIndexes.endIndex) {\n            setSelectedSections(selectedSectionIndexes.startIndex);\n          } else {\n            const nextSectionIndex = sectionOrder.neighbors[selectedSectionIndexes.startIndex].leftIndex;\n            if (nextSectionIndex !== null) {\n              setSelectedSections(nextSectionIndex);\n            }\n          }\n          break;\n        }\n\n      // Reset the value of the selected section\n      case event.key === 'Delete':\n        {\n          event.preventDefault();\n          if (readOnly) {\n            break;\n          }\n          if (selectedSectionIndexes == null || selectedSectionIndexes.startIndex === 0 && selectedSectionIndexes.endIndex === state.sections.length - 1) {\n            clearValue();\n          } else {\n            clearActiveSection();\n          }\n          resetCharacterQuery();\n          break;\n        }\n\n      // Increment / decrement the selected section value\n      case ['ArrowUp', 'ArrowDown', 'Home', 'End', 'PageUp', 'PageDown'].includes(event.key):\n        {\n          event.preventDefault();\n          if (readOnly || selectedSectionIndexes == null) {\n            break;\n          }\n          const activeSection = state.sections[selectedSectionIndexes.startIndex];\n          const activeDateManager = fieldValueManager.getActiveDateManager(utils, state, activeSection);\n          const newSectionValue = adjustSectionValue(utils, timezone, activeSection, event.key, sectionsValueBoundaries, activeDateManager.date, {\n            minutesStep\n          });\n          updateSectionValue({\n            activeSection,\n            newSectionValue,\n            shouldGoToNextSection: false\n          });\n          break;\n        }\n    }\n  });\n  useEnhancedEffect(() => {\n    if (!inputRef.current) {\n      return;\n    }\n    if (selectedSectionIndexes == null) {\n      if (inputRef.current.scrollLeft) {\n        // Ensure that input content is not marked as selected.\n        // setting selection range to 0 causes issues in Safari.\n        // https://bugs.webkit.org/show_bug.cgi?id=224425\n        inputRef.current.scrollLeft = 0;\n      }\n      return;\n    }\n    const firstSelectedSection = state.sections[selectedSectionIndexes.startIndex];\n    const lastSelectedSection = state.sections[selectedSectionIndexes.endIndex];\n    let selectionStart = firstSelectedSection.startInInput;\n    let selectionEnd = lastSelectedSection.endInInput;\n    if (selectedSectionIndexes.shouldSelectBoundarySelectors) {\n      selectionStart -= firstSelectedSection.startSeparator.length;\n      selectionEnd += lastSelectedSection.endSeparator.length;\n    }\n    if (selectionStart !== inputRef.current.selectionStart || selectionEnd !== inputRef.current.selectionEnd) {\n      // Fix scroll jumping on iOS browser: https://github.com/mui/mui-x/issues/8321\n      const currentScrollTop = inputRef.current.scrollTop;\n      // On multi input range pickers we want to update selection range only for the active input\n      // This helps to avoid the focus jumping on Safari https://github.com/mui/mui-x/issues/9003\n      // because WebKit implements the `setSelectionRange` based on the spec: https://bugs.webkit.org/show_bug.cgi?id=224425\n      if (inputRef.current === getActiveElement(document)) {\n        inputRef.current.setSelectionRange(selectionStart, selectionEnd);\n      }\n      // Even reading this variable seems to do the trick, but also setting it just to make use of it\n      inputRef.current.scrollTop = currentScrollTop;\n    }\n  });\n  const validationError = useValidation(_extends({}, internalProps, {\n    value: state.value,\n    timezone\n  }), validator, valueManager.isSameError, valueManager.defaultErrorState);\n  const inputError = React.useMemo(() => {\n    // only override when `error` is undefined.\n    // in case of multi input fields, the `error` value is provided externally and will always be defined.\n    if (error !== undefined) {\n      return error;\n    }\n    return valueManager.hasError(validationError);\n  }, [valueManager, validationError, error]);\n  React.useEffect(() => {\n    if (!inputError && !selectedSectionIndexes) {\n      resetCharacterQuery();\n    }\n  }, [state.referenceValue, selectedSectionIndexes, inputError]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  React.useEffect(() => {\n    // Select the right section when focused on mount (`autoFocus = true` on the input)\n    if (inputRef.current && inputRef.current === document.activeElement) {\n      setSelectedSections('all');\n    }\n    return () => window.clearTimeout(focusTimeoutRef.current);\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\n\n  // If `state.tempValueStrAndroid` is still defined when running `useEffect`,\n  // Then `onChange` has only been called once, which means the user pressed `Backspace` to reset the section.\n  // This causes a small flickering on Android,\n  // But we can't use `useEnhancedEffect` which is always called before the second `onChange` call and then would cause false positives.\n  React.useEffect(() => {\n    if (state.tempValueStrAndroid != null && selectedSectionIndexes != null) {\n      resetCharacterQuery();\n      clearActiveSection();\n    }\n  }, [state.tempValueStrAndroid]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  const valueStr = React.useMemo(() => {\n    var _state$tempValueStrAn;\n    return (_state$tempValueStrAn = state.tempValueStrAndroid) != null ? _state$tempValueStrAn : fieldValueManager.getValueStrFromSections(state.sections, isRTL);\n  }, [state.sections, fieldValueManager, state.tempValueStrAndroid, isRTL]);\n  const inputMode = React.useMemo(() => {\n    if (selectedSectionIndexes == null) {\n      return 'text';\n    }\n    if (state.sections[selectedSectionIndexes.startIndex].contentType === 'letter') {\n      return 'text';\n    }\n    return 'numeric';\n  }, [selectedSectionIndexes, state.sections]);\n  const inputHasFocus = inputRef.current && inputRef.current === getActiveElement(document);\n  const areAllSectionsEmpty = valueManager.areValuesEqual(utils, state.value, valueManager.emptyValue);\n  const shouldShowPlaceholder = !inputHasFocus && areAllSectionsEmpty;\n  React.useImperativeHandle(unstableFieldRef, () => ({\n    getSections: () => state.sections,\n    getActiveSectionIndex: () => {\n      var _selectionStart2, _selectionEnd;\n      const browserStartIndex = (_selectionStart2 = inputRef.current.selectionStart) != null ? _selectionStart2 : 0;\n      const browserEndIndex = (_selectionEnd = inputRef.current.selectionEnd) != null ? _selectionEnd : 0;\n      if (browserStartIndex === 0 && browserEndIndex === 0) {\n        return null;\n      }\n      const nextSectionIndex = browserStartIndex <= state.sections[0].startInInput ? 1 // Special case if browser index is in invisible characters at the beginning.\n      : state.sections.findIndex(section => section.startInInput - section.startSeparator.length > browserStartIndex);\n      return nextSectionIndex === -1 ? state.sections.length - 1 : nextSectionIndex - 1;\n    },\n    setSelectedSections: activeSectionIndex => setSelectedSections(activeSectionIndex)\n  }));\n  const handleClearValue = useEventCallback((event, ...args) => {\n    var _inputRef$current;\n    event.preventDefault();\n    onClear == null || onClear(event, ...args);\n    clearValue();\n    inputRef == null || (_inputRef$current = inputRef.current) == null || _inputRef$current.focus();\n    setSelectedSections(0);\n  });\n  return _extends({\n    placeholder,\n    autoComplete: 'off',\n    disabled: Boolean(disabled)\n  }, otherForwardedProps, {\n    value: shouldShowPlaceholder ? '' : valueStr,\n    inputMode,\n    readOnly,\n    onClick: handleInputClick,\n    onFocus: handleInputFocus,\n    onBlur: handleInputBlur,\n    onPaste: handleInputPaste,\n    onChange: handleInputChange,\n    onKeyDown: handleInputKeyDown,\n    onMouseUp: handleInputMouseUp,\n    onClear: handleClearValue,\n    error: inputError,\n    ref: handleRef,\n    clearable: Boolean(clearable && !areAllSectionsEmpty && !readOnly && !disabled)\n  });\n};"]},"metadata":{},"sourceType":"module"}